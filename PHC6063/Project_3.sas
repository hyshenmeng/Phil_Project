* exp1-Sub-TBI;
/* DATA INPUT */
PROC IMPORT DATAFILE= "F:\exp1-Sub-TBI.csv"
  OUT=exp1SubTBI 
  DBMS=CSV REPLACE;
  GETNAMES=YES;    
RUN;

/* DATA TRANSFORMATION */
Data exp1SubTBI2;
  SET exp1SubTBI;
  DO i=1 TO _0;
  OUTPUT;
  END;
RUN;

/* DATA MANIPUNATION */
Data exp1SubTBI3;
  SET exp1SubTBI2;
  NEWID=_N_;
  S7=_7-_0;
  IF S7=0 THEN Y=0;
  IF S7=-ABS(_0) THEN Y=1;
RUN;
Data exp1SubTBI4;
  SET exp1SubTBI3;
  IF NEWID=16 THEN Y=1;
  IF NEWID=17 THEN Y=0;
  IF NEWID=18 THEN Y=0;
RUN;

/* LOGISTIC REGRESSION */
PROC LOGISTIC DATA=exp1SubTBI4 DESCENDING;
  MODEL Y=DOSE / COVB;
  ODS OUTPUT PARAMETERESTIMATES=coef1 COVB=cov1;
RUN; 

/* LD50 */
DATA LD50_exp1SubTBI;
    LD50=-(-22.2309/1.4655);
    VAR_LD50=(1/1.4655**2)*83.92131+((-22.2309)**2)*(1/1.4655**4)*0.363236-2*(-22.2309)*(1/1.4655**3)*(-5.5049);
    SE_LD50=SQRT(VAR_LD50);
    LOW_LD50=LD50-1.96*SE_LD50;
    UP_LD50=LD50+1.96*SE_LD50;
RUN;
PROC PRINT DATA=LD50_exp1SubTBI;
RUN;

* exp2-Sub-TBI;
/* DATA INPUT */
PROC IMPORT DATAFILE= "F:\exp2-Sub-TBI.csv"
  OUT=exp2SubTBI 
  DBMS=CSV REPLACE;
  GETNAMES=YES;    
RUN;

/* DATA TRANSFORMATION */
Data exp2SubTBI2;
  SET exp2SubTBI;
  DO i=1 TO _0;
  OUTPUT;
  END;
RUN;

/* DATA MANIPUNATION */
Data exp2SubTBI3;
  SET exp2SubTBI2;
  NEWID=_N_;
  S7=_7-_0;
  IF S7=0 THEN Y=0;
  IF S7=-ABS(_0) THEN Y=1;
RUN;
Data exp2SubTBI4;
  SET exp2SubTBI3;
  IF NEWID=20 THEN Y=1;
  IF NEWID=21 THEN Y=0;
  IF NEWID=22 THEN Y=0;
RUN;

/* LOGISTIC REGRESSION */
PROC LOGISTIC DATA=exp2SubTBI4 DESCENDING;
  MODEL Y=DOSE / COVB;
RUN; 

* exp2-TBI;
/* DATA INPUT */
PROC IMPORT DATAFILE= "F:\exp2-TBI.csv"
  OUT=exp2TBI 
  DBMS=CSV REPLACE;
  GETNAMES=YES;    
RUN;

/* DATA TRANSFORMATION */
Data exp2TBI2;
  SET exp2TBI;
  DO i=1 TO _0;
  OUTPUT;
  END;
RUN;

/* DATA MANIPUNATION */
Data exp2TBI3;
  SET exp2TBI2;
  NEWID=_N_;
  S30=_30-_0;
  IF S30=0 THEN Y=0;
  IF S30=-ABS(_0) THEN Y=1;
RUN;
Data exp2TBI4;
  SET exp2TBI3;
  IF NEWID=4 THEN Y=1;
  IF NEWID=5 THEN Y=0;
  IF NEWID=6 THEN Y=0;
  IF NEWID=7 THEN Y=0;
  IF NEWID=8 THEN Y=0;
  IF NEWID=9 THEN Y=1;
  IF NEWID=10 THEN Y=0;
  IF NEWID=11 THEN Y=0;
  IF NEWID=12 THEN Y=0;
  IF NEWID=13 THEN Y=0;
RUN;

/* LOGISTIC REGRESSION */
PROC LOGISTIC DATA=exp2TBI4 DESCENDING;
  MODEL Y=DOSE / COVB;
  ODS OUTPUT PARAMETERESTIMATES=coef1 COVB=cov1;
RUN; 

/* LD50 */
DATA LD50_exp2TBI;
    LD50=-(-35.7105/4.7323);
    VAR_LD50=(1/4.7323**2)*221.9038+((-35.7105)**2)*(1/4.7323**4)*3.873017-2*(-35.7105)*(1/4.7323**3)*(-29.2845);
    SE_LD50=SQRT(VAR_LD50);
    LOW_LD50=LD50-1.96*SE_LD50;
    UP_LD50=LD50+1.96*SE_LD50;
RUN;
PROC PRINT DATA=LD50_exp2TBI;
RUN; 


